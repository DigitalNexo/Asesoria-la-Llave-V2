{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{readFile}from\"fs/promises\";import{join,dirname}from\"path\";import{fileURLToPath}from\"url\";const __filename=fileURLToPath(import.meta.url);const __dirname=dirname(__filename);async function getCurrentVersion(){try{const packageJsonPath=join(__dirname,\"../../package.json\");const packageJson=await readFile(packageJsonPath,\"utf-8\");const pkg=JSON.parse(packageJson);return pkg.version||\"1.0.0\"}catch(error){console.error(\"Error al leer package.json:\",error);return\"1.0.0\"}}__name(getCurrentVersion,\"getCurrentVersion\");async function getLatestGitHubVersion(owner,repo){try{const url=`https://api.github.com/repos/${owner}/${repo}/releases/latest`;const response=await fetch(url,{headers:{\"Accept\":\"application/vnd.github.v3+json\",\"User-Agent\":\"Asesoria-La-Llave-App\"}});if(!response.ok){if(response.status===404){console.log(\"No se encontraron releases en GitHub\");return null}throw new Error(`GitHub API error: ${response.status}`)}const release=await response.json();if(release.draft||release.prerelease){return null}return release}catch(error){console.error(\"Error al consultar GitHub:\",error);return null}}__name(getLatestGitHubVersion,\"getLatestGitHubVersion\");function compareVersions(v1,v2){const parts1=v1.replace(/^v/,\"\").split(\".\").map(Number);const parts2=v2.replace(/^v/,\"\").split(\".\").map(Number);for(let i=0;i<3;i++){const p1=parts1[i]||0;const p2=parts2[i]||0;if(p1>p2)return 1;if(p1<p2)return-1}return 0}__name(compareVersions,\"compareVersions\");async function checkForUpdates(owner,repo){const currentVersion=await getCurrentVersion();const latestRelease=await getLatestGitHubVersion(owner,repo);if(!latestRelease){return{current:currentVersion,latest:null,updateAvailable:false}}const latestVersion=latestRelease.tag_name.replace(/^v/,\"\");const updateAvailable=compareVersions(latestVersion,currentVersion)>0;return{current:currentVersion,latest:latestVersion,updateAvailable,releaseNotes:latestRelease.body,publishedAt:latestRelease.published_at}}__name(checkForUpdates,\"checkForUpdates\");async function performHealthCheck(){const checks=[];let allPassed=true;try{await getCurrentVersion();checks.push({name:\"Package.json\",status:\"pass\",message:\"Archivo legible y versi\\xF3n disponible\"})}catch(error){allPassed=false;checks.push({name:\"Package.json\",status:\"fail\",message:`Error: ${error.message}`})}try{const serverUrl=process.env.NODE_ENV===\"production\"?\"http://localhost:5000\":\"http://localhost:5000\";const response=await fetch(`${serverUrl}/api/health`,{method:\"GET\",headers:{\"Accept\":\"application/json\"}}).catch(()=>null);if(response&&response.ok){checks.push({name:\"API Health\",status:\"pass\",message:\"Servidor responde correctamente\"})}else{checks.push({name:\"API Health\",status:\"fail\",message:\"Servidor no responde o endpoint de health no disponible\"})}}catch(error){checks.push({name:\"API Health\",status:\"fail\",message:`Error al verificar servidor: ${error.message}`})}try{const{PrismaClient}=await import(\"@prisma/client\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});const prisma=new PrismaClient;await prisma.$queryRaw`SELECT 1 as healthcheck`;await prisma.$disconnect();checks.push({name:\"Database\",status:\"pass\",message:\"Conexi\\xF3n a base de datos exitosa\"})}catch(error){allPassed=false;checks.push({name:\"Database\",status:\"fail\",message:`Error de conexi\\xF3n: ${error.message}`})}return{success:allPassed,checks,timestamp:new Date}}__name(performHealthCheck,\"performHealthCheck\");export{checkForUpdates,compareVersions,getCurrentVersion,getLatestGitHubVersion,performHealthCheck};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/usuario/Documents/Repositorios/Asesoria-La-Llave/server/services/version-service.ts"],"sourcesContent":[null]}}