{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import fs from\"fs/promises\";import path from\"path\";class LocalStorageProvider{static{__name(this,\"LocalStorageProvider\")}constructor(basePath=path.join(process.cwd(),\"uploads\")){this.basePath=basePath}async upload(file,relativePath){const fullPath=path.join(this.basePath,relativePath);const dir=path.dirname(fullPath);await fs.mkdir(dir,{recursive:true});if(Buffer.isBuffer(file)){await fs.writeFile(fullPath,file)}else{const writeStream=(await import(\"fs\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s})).createWriteStream(fullPath);await new Promise((resolve,reject)=>{file.pipe(writeStream);file.on(\"end\",resolve);file.on(\"error\",reject);writeStream.on(\"error\",reject)})}return relativePath}async download(relativePath){const fullPath=path.join(this.basePath,relativePath);return await fs.readFile(fullPath)}async delete(relativePath){const fullPath=path.join(this.basePath,relativePath);await fs.unlink(fullPath)}async list(relativePath=\"\",recursive=false){const fullPath=path.join(this.basePath,relativePath);const files=[];try{const entries=await fs.readdir(fullPath,{withFileTypes:true});for(const entry of entries){const entryPath=path.join(relativePath,entry.name);if(entry.isFile()){files.push(entryPath)}else if(entry.isDirectory()&&recursive){const subFiles=await this.list(entryPath,true);files.push(...subFiles)}}}catch(error){if(error.code!==\"ENOENT\"){throw error}}return files}async exists(relativePath){const fullPath=path.join(this.basePath,relativePath);try{await fs.access(fullPath);return true}catch{return false}}getPublicUrl(relativePath){return`/uploads/${relativePath}`}}async function streamToBuffer(stream){const chunks=[];return new Promise((resolve,reject)=>{stream.on(\"data\",chunk=>chunks.push(Buffer.from(chunk)));stream.on(\"error\",reject);stream.on(\"end\",()=>resolve(Buffer.concat(chunks)))})}__name(streamToBuffer,\"streamToBuffer\");export{LocalStorageProvider,streamToBuffer};\n","warnings":[],"map":{"version":3,"mappings":"kHAAA,OAAO,OAAQ,cACf,OAAO,SAAU,OA4BV,MAAM,oBAAgD,CA7B7D,MA6B6D,qCAG3D,YAAY,SAAmB,KAAK,KAAK,QAAQ,IAAI,EAAG,SAAS,EAAG,CAClE,KAAK,SAAW,QAClB,CAEA,MAAM,OAAO,KAAyB,aAAuC,CAC3E,MAAM,SAAW,KAAK,KAAK,KAAK,SAAU,YAAY,EACtD,MAAM,IAAM,KAAK,QAAQ,QAAQ,EAGjC,MAAM,GAAG,MAAM,IAAK,CAAE,UAAW,IAAK,CAAC,EAEvC,GAAI,OAAO,SAAS,IAAI,EAAG,CAEzB,MAAM,GAAG,UAAU,SAAU,IAAI,CACnC,KAAO,CAEL,MAAM,aAAe,KAAM,QAAO,IAAI,+FAAG,kBAAkB,QAAQ,EACnE,MAAM,IAAI,QAAQ,CAAC,QAAS,SAAW,CACrC,KAAK,KAAK,WAAW,EACrB,KAAK,GAAG,MAAO,OAAO,EACtB,KAAK,GAAG,QAAS,MAAM,EACvB,YAAY,GAAG,QAAS,MAAM,CAChC,CAAC,CACH,CAEA,OAAO,YACT,CAEA,MAAM,SAAS,aAAuC,CACpD,MAAM,SAAW,KAAK,KAAK,KAAK,SAAU,YAAY,EACtD,OAAO,MAAM,GAAG,SAAS,QAAQ,CACnC,CAEA,MAAM,OAAO,aAAqC,CAChD,MAAM,SAAW,KAAK,KAAK,KAAK,SAAU,YAAY,EACtD,MAAM,GAAG,OAAO,QAAQ,CAC1B,CAEA,MAAM,KAAK,aAAuB,GAAI,UAAqB,MAA0B,CACnF,MAAM,SAAW,KAAK,KAAK,KAAK,SAAU,YAAY,EACtD,MAAM,MAAkB,CAAC,EAEzB,GAAI,CACF,MAAM,QAAU,MAAM,GAAG,QAAQ,SAAU,CAAE,cAAe,IAAK,CAAC,EAElE,UAAW,SAAS,QAAS,CAC3B,MAAM,UAAY,KAAK,KAAK,aAAc,MAAM,IAAI,EAEpD,GAAI,MAAM,OAAO,EAAG,CAClB,MAAM,KAAK,SAAS,CACtB,SAAW,MAAM,YAAY,GAAK,UAAW,CAC3C,MAAM,SAAW,MAAM,KAAK,KAAK,UAAW,IAAI,EAChD,MAAM,KAAK,GAAG,QAAQ,CACxB,CACF,CACF,OAAS,MAAO,CAEd,GAAK,MAAgC,OAAS,SAAU,CACtD,MAAM,KACR,CACF,CAEA,OAAO,KACT,CAEA,MAAM,OAAO,aAAwC,CACnD,MAAM,SAAW,KAAK,KAAK,KAAK,SAAU,YAAY,EACtD,GAAI,CACF,MAAM,GAAG,OAAO,QAAQ,EACxB,MAAO,KACT,MAAQ,CACN,MAAO,MACT,CACF,CAEA,aAAa,aAA8B,CAGzC,MAAO,YAAY,YAAY,EACjC,CACF,CAGA,eAAsB,eAAe,OAAmC,CACtE,MAAM,OAAmB,CAAC,EAE1B,OAAO,IAAI,QAAQ,CAAC,QAAS,SAAW,CACtC,OAAO,GAAG,OAAS,OAAU,OAAO,KAAK,OAAO,KAAK,KAAK,CAAC,CAAC,EAC5D,OAAO,GAAG,QAAS,MAAM,EACzB,OAAO,GAAG,MAAO,IAAM,QAAQ,OAAO,OAAO,MAAM,CAAC,CAAC,CACvD,CAAC,CACH,CARsB","names":[],"ignoreList":[],"sources":["/Users/usuario/Documents/Repositorios/Asesoria-La-Llave/server/services/storage-provider.ts"],"sourcesContent":[null]}}