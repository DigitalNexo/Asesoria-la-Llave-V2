{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import pino from\"pino\";import pinoHttp from\"pino-http\";import{randomUUID}from\"crypto\";import path from\"path\";import fs from\"fs\";const logsDir=process.env.LOG_DIR||path.join(process.cwd(),\"logs\");if(!fs.existsSync(logsDir)){fs.mkdirSync(logsDir,{recursive:true})}const today=new Date().toISOString().split(\"T\")[0];const logFile=path.join(logsDir,`app-${today}.log`);const logger=pino({level:process.env.LOG_LEVEL||\"info\",transport:process.env.NODE_ENV===\"development\"?{target:\"pino-pretty\",options:{colorize:true,translateTime:\"HH:MM:ss Z\",ignore:\"pid,hostname\"}}:void 0,...process.env.NODE_ENV!==\"development\"&&{stream:pino.destination({dest:logFile,sync:false})},formatters:{level:__name(label=>{return{level:label.toUpperCase()}},\"level\")}});const httpLogger=pinoHttp({logger,genReqId:__name((req,res)=>{const existingId=req.headers[\"x-request-id\"];if(existingId&&typeof existingId===\"string\"){return existingId}return randomUUID()},\"genReqId\"),customLogLevel:__name((req,res,err)=>{if(res.statusCode>=500||err)return\"error\";if(res.statusCode>=400)return\"warn\";if(res.statusCode>=300)return\"info\";return\"info\"},\"customLogLevel\"),customSuccessMessage:__name((req,res)=>{return`${req.method} ${req.url} ${res.statusCode}`},\"customSuccessMessage\"),customErrorMessage:__name((req,res,err)=>{return`${req.method} ${req.url} ${res.statusCode} - ${err.message}`},\"customErrorMessage\"),customAttributeKeys:{req:\"request\",res:\"response\",err:\"error\",responseTime:\"duration\"},serializers:{req:__name(req=>({id:req.id,method:req.method,url:req.url,headers:{host:req.headers?.host,\"user-agent\":req.headers?.[\"user-agent\"],\"content-type\":req.headers?.[\"content-type\"]},remoteAddress:req.socket?.remoteAddress,remotePort:req.socket?.remotePort}),\"req\"),res:__name(res=>({statusCode:res.statusCode,headers:{\"content-type\":typeof res.getHeader===\"function\"?res.getHeader(\"content-type\"):void 0,\"content-length\":typeof res.getHeader===\"function\"?res.getHeader(\"content-length\"):void 0}}),\"res\"),err:pino.stdSerializers.err},autoLogging:{ignore:__name(req=>{return!!(req.url===\"/health\"||req.url===\"/ready\"||req.url?.startsWith(\"/assets/\")||req.url?.startsWith(\"/favicon\"))},\"ignore\")}});const securityLogger=logger.child({module:\"security\"});const dbLogger=logger.child({module:\"database\"});const authLogger=logger.child({module:\"auth\"});const jobLogger=logger.child({module:\"jobs\"});const storageLogger=logger.child({module:\"storage\"});function logError(error,context){logger.error({err:error,stack:error.stack,...context},error.message)}__name(logError,\"logError\");function logAudit(action,userId,details){logger.info({type:\"audit\",action,userId,...details},`Audit: ${action} by user ${userId}`)}__name(logAudit,\"logAudit\");function rotateOldLogs(retentionDays=30){try{const files=fs.readdirSync(logsDir);const now=Date.now();const maxAge=retentionDays*24*60*60*1e3;files.forEach(file=>{if(!file.startsWith(\"app-\")||!file.endsWith(\".log\"))return;const filePath=path.join(logsDir,file);const stats=fs.statSync(filePath);const age=now-stats.mtimeMs;if(age>maxAge){fs.unlinkSync(filePath);logger.info(`Deleted old log file: ${file}`)}})}catch(error){logger.error({err:error},\"Error rotating logs\")}}__name(rotateOldLogs,\"rotateOldLogs\");rotateOldLogs(30);var logger_default=logger;export{authLogger,dbLogger,logger_default as default,httpLogger,jobLogger,logAudit,logError,logger,rotateOldLogs,securityLogger,storageLogger};\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/usuario/Documents/Repositorios/Asesoria-La-Llave/server/logger.ts"],"sourcesContent":[null]}}