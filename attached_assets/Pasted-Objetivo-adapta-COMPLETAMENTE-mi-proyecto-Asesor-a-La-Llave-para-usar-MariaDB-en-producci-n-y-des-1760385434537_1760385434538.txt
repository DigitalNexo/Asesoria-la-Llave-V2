Objetivo: adapta COMPLETAMENTE mi proyecto “Asesoría La Llave” para usar MariaDB en producción y desarrollo (no Postgres).
Quiero que pueda “enchufar” mi MariaDB propia (VPS/host externo) y que el proyecto traiga:

Migraciones + esquema SQL completos para crear TODAS las tablas en MariaDB.
Scripts de seed.
Variables .env para MariaDB.
Docker Compose con servicio mariadb opcional.
Backups con mysqldump.
Todo lo que ya tengo funcionando, pero apuntando a MariaDB.
0) ORM y capas de datos
Sustituye el uso de Postgres/Drizzle por Prisma con provider mysql (compatible MariaDB) en /prisma/schema.prisma.
Crea modelos Prisma para TODOS los módulos: users, roles, clients, tax_models, tax_periods, client_tax, tax_files, tasks (con visibilidad GENERAL|PERSONAL), manuals, activity_logs, smtp_config, job_runs (para cron), y cualquier tabla pivote (p.ej. client_user).
Añade índices y claves foráneas coherentes.
Genera migraciones Prisma en /prisma/migrations.
Genera también un dump SQL completo de creación de tablas para MariaDB en /database/schema_mariadb.sql (charset utf8mb4, collation utf8mb4_unicode_ci), con todos los índices y FKs.
Proporciona scripts npm:
npm run db:generate (prisma generate)
npm run db:migrate (prisma migrate deploy/dev según entorno)
npm run db:seed (semillas iniciales con contraseñas bcrypt)
npm run db:sql (export del SQL a /database/schema_mariadb.sql)
1) Variables de entorno (MariaDB)
En .env.example define:
NODE_ENV=development
PORT=5000
FRONTEND_URL=http://localhost:3000
JWT_SECRET=CAMBIA_ESTE_VALOR
DATABASE_URL=“mysql://USER:PASS@HOST:3306/asesoria_llave?socket_timeout=60&connect_timeout=60”
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=
S3_ENDPOINT=
S3_BUCKET=
S3_ACCESS_KEY=
S3_SECRET_KEY=
S3_REGION=
En el README, explica que yo pondré mis credenciales reales de MariaDB (host, user, pass) y que puedo usar el servicio Docker opcional si quiero.
2) Mapeo de tipos y constraints (MariaDB)
Usa VARCHAR(191) para fields con índices únicos (por compatibilidad InnoDB).
TEXT/LONGTEXT donde aplique (manuales content_html).
Timestamps con DATETIME(3) y valores por defecto.
Enums Prisma para estados (tareas, impuestos, visibilidad).
Añade índices:
tasks: (visibilidad), (asignado_a), (cliente_id, estado), (fecha_vencimiento)
client_tax: (client_id, tax_period_id), (estado), (created_at)
manuals: (publicado), (categoria), (autor_id)
activity_logs: (usuario_id, modulo, fecha)
clients: (nif_cif unique), (responsable_asignado)
FK ON DELETE/UPDATE adecuadas (CASCADE donde aplique: files de un client_tax, etc.)
3) Seeds y datos de ejemplo
npm run db:seed debe crear:
3 usuarios: admin/gestor/lectura (pass admin123)
5 clientes (autónomos/empresas)
Modelos fiscales: 303, 390, 130, 131
Periodos 2024 y 2025
5 tareas (mezcla GENERAL/PERSONAL)
2 manuales
Asegura que los seeds funcionan con MariaDB real y con el contenedor Docker.
4) Sustituir almacenamiento local y cron
Subidas: cambia /uploads a almacenamiento S3-compatible (Backblaze/MinIO/AWS), validando MIME real con file-type, permitiendo sólo PDF/PNG/JPG/XLSX/DOCX, 10MB máx. Guarda sólo la URL y metadatos en BD.
Jobs: reemplaza setInterval por node-cron (o Agenda) para:
Recordatorios de tareas (3 días antes).
Recordatorios de impuestos (7 días antes).
Registrar ejecuciones en job_runs.
Añade comando npm run jobs:start.
5) Seguridad (auth y cabeceras)
Migra autenticación: cookies httpOnly + secure + SameSite=Lax.
Añade CSRF tokens en endpoints mutadores y ajusta el frontend a /auth/profile para estado.
Refuerza Helmet con CSP estricta:
default-src ‘self’;
img-src ‘self’ data: blob:;
style-src ‘self’ ‘unsafe-inline’;
script-src ‘self’;
connect-src ‘self’;
font-src ‘self’;
frame-ancestors ‘none’;